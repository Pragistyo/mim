<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <!--Latest compiled and minified CSS-->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

  <script src="https://unpkg.com/vue"></script>

  <title>Form Upload</title>
</head>

<body>
  <div class="container" id="app">
    <uploadfile></uploadfile>
  </div>
</body>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script>
  Vue.component('uploadfile', {
    template: `
    <div>
      <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal" @click="dismissModal">Open Modal</button>
      <div id="myModal" class="modal fade" role="dialog">
        <div class="modal-dialog">

          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <legend>
                Upload File
              </legend>
            </div>
            <div class="modal-body">
              <form v-on:submit.prevent="createImage" class="form-horizontal">
                <fieldset>
                  <div class="form-group">
                    <label for="input-image" class="col-lg-2 control-label">Picture</label>
                    <div class="col-md-8">
                      <input name="input-image" type="file" class="form-control" id="upload" placeholder="File Picture" v-model="imageName" @change="onFileChange">
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="caption" class="col-lg-2 control-label">Caption</label>
                    <div class="col-md-8">
                      <input name="caption" type="text" class="form-control" placeholder="Insert your caption" v-model="caption">
                    </div>
                  </div>
                  <div class="form-group">
                    <div class="col-lg-10 col-lg-offset-2">
                      <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Submit</button>
                        <button type="reset" class="btn btn-default" data-dismiss="modal" @click="removeImage">Cancel</button>
                      </div>
                    </div>
                  </div>
                  <p class="lead text-center">{{ caption }}</p>
                  <a v-if="image !== ''" href="#" class="thumbnail">
                                <img :src="image" :alt="image" />
                              </a>
                </fieldset>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
      `,
    data: function() {
      return {
        image: '',
        resultUpload: null,
        closeModal: null,
        caption: '',
        imageName: '',
      }
    },
    methods: {
      onFileChange(e) {
        // alert(JSON.stringify(e))
        console.log(e)
        var files = e.target.files || e.dataTransfer.files;

        if (!files.length) {
          return;
        }
        this.resultUpload = files[0]
        var image = new Image();
        var reader = new FileReader();
        var vm = this;

        reader.onload = (e) => {
          vm.image = e.target.result;
        };
        // reader.readAsDataURL(file);
        reader.readAsDataURL(this.resultUpload);
        // this.createImage(files[0]);
      },
      createImage(file) {
        let data = new FormData();
        data.append('caption', this.caption);
        data.append('file', this.resultUpload);
        axios.post('http://localhost:3000/posts/add_post', data)
          .then(function(res) {

          })
          .catch(function(err) {
            console.log(err);
          });
        $('#myModal').modal('hide');
      },
      removeImage: function(e) {
        this.image = '';
        this.imageName = '';
        this.caption = '';
      },
      dismissModal: function() {
        // this.closeModal = "modal"
      }
    }
  })
  new Vue({
    el: '#app',
  })
</script>

</html>
